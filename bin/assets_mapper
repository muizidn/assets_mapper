#!/usr/bin/env ruby

require 'assets_mapper'
require 'optparse'

options = {}
OptionParser.new do |opts|
  opts.banner = "Usage assets_mapper [argument] [options]"
  opts.on('--ignore-folder', 'ignore foldering from xcasset folder' ) do |ignore|
    options[:ignore_folder] = ignore
  end
end.parse!

ignore = options[:ignore_folder] || false

xcassets = if ARGV[0]&.include?'.xcassets' then 
    [ARGV[0]]
  else 
    Dir.glob('./**/*.xcassets') 
  end
swifts =  if ARGV[0]&.include?'.swift' then
    [ARGV[0]] 
  else 
    Dir.glob('./**/*.swift')
      .select do |f|
        name = f.match('/*(.*).swift').captures[0] 
        xcassets.any? {|s| s.include? name }
      end
  end 

no_match = 0
xcassets.sort.each do |x|
  xcasset, name = x.match('.*/((.*)\.xcassets)').captures
  print "Found " + xcasset.green
  if swifts.any? {|s| s.include?name} then
    print " Match " + "#{name}.swift".yellow
  else
    print " No matching swift file".red
    no_match = no_match + 1
  end
  puts
end

if no_match != 0
puts "\n\nFound #{no_match} xcassets without swift file pair!!!".red
end